import{r as l,a as b,j as e,c as y}from"./tailwind-3PTRaMQq.js";function w(){const[r,p]=l.useState(null),[o,u]=l.useState(0),[x,h]=l.useState([]),[f]=l.useState(1024*1024*1024);l.useEffect(()=>{m()},[]);async function m(){const s=await b("/api/r2/list");h(s.objects||[])}async function g(){if(!r)return alert("choose a file");if(r.size>f)return alert("file exceeds max size (1GB)");const s=new URLSearchParams({filename:r.name,contentType:r.type}),t=await(await fetch(`/api/r2/presign?${s.toString()}`)).json();if(!(t!=null&&t.url))return alert("presign failed: "+JSON.stringify(t));const c=t.url;await j(c,r,i=>u(i)),alert("Upload complete"),u(0),p(null),m()}function j(s,n,t){return new Promise((c,i)=>{const a=new XMLHttpRequest;a.open("PUT",s,!0),a.setRequestHeader("Content-Type",n.type||"application/octet-stream"),a.upload.onprogress=function(d){d.lengthComputable&&t(Math.round(d.loaded/d.total*100))},a.onload=function(){a.status>=200&&a.status<300?c():i(new Error("Upload failed: "+a.statusText+" "+a.status))},a.onerror=function(){i(new Error("XHR network error"))},a.send(n)})}return e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("header",{className:"flex items-center gap-4 mb-4",children:[e.jsx("img",{src:"/src/img/apple-logo.png",alt:"logo",className:"w-12 h-12 rounded-lg"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Upload Files"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Direct upload to R2 â€” supports up to 1GB"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"file",onChange:s=>{var n,t;return p(((t=(n=s.target)==null?void 0:n.files)==null?void 0:t[0])??null)}}),e.jsx("div",{children:e.jsx("button",{onClick:g,className:"bg-black text-white px-4 py-2 rounded-md",disabled:!r,children:"Upload"})}),o>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded",children:e.jsxs("div",{className:"bg-black text-white rounded text-sm",style:{width:`${o}%`},children:[o,"%"]})}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-medium mb-2",children:"Uploaded files"}),e.jsx("ul",{className:"space-y-2",children:x.map(s=>e.jsxs("li",{className:"p-2 border rounded flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.key.split("/").pop()}),e.jsxs("div",{className:"text-sm text-gray-500",children:[(s.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsx("div",{children:e.jsx("a",{className:"text-blue-600",href:`https://${location.hostname}/${s.key}`,target:"_blank",rel:"noreferrer",children:"Open"})})]},s.key))})]})]})]})})}y(document.getElementById("root")).render(e.jsx(w,{}));
